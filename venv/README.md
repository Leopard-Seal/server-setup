# Python仮想環境セットアップスクリプト

このスクリプト(`venv_setup.sh`)は、Pythonの仮想環境を簡単に設定し、PyTorchとxformersをインストールするためのものです。

## 機能

- 指定された作業ディレクトリ内にPython仮想環境を作成
- pipの最新版へのアップグレード
- PyTorchのインストール（CUDAバージョンの自動検出と選択）
- xformersのインストール
- オプションでPyTorchとxformersのインストールをスキップ可能
- オプションで仮想環境をアクティブなままにすることが可能

## 使用方法

### スクリプトの実行

```bash
./venv_setup.sh [-d <work_directory>] [-r] [-s] [-x] [-o <output_file>] [-h]
```

### オプション

- `-d <work_directory>`: 作業ディレクトリ名を指定
- `-r`: スクリプト終了後も仮想環境をアクティブなままにする
- `-s`: PyTorchのインストールをスキップ
- `-x`: xformersのインストールをスキップ
- `-o <output_file>`: ヘルプメッセージを指定されたファイルに出力
- `-h`: ヘルプメッセージを表示

### 例

1. デフォルトの動作（対話的に作業ディレクトリ名を入力）:
   ```bash
   ./venv_setup.sh
   ```

2. 作業ディレクトリ名を指定して実行:
   ```bash
   ./venv_setup.sh -d myproject
   ```

3. 作業ディレクトリ名を指定し、仮想環境をアクティブなままにする:
   ```bash
   ./venv_setup.sh -d myproject -r
   ```

4. PyTorchのインストールをスキップ:
   ```bash
   ./venv_setup.sh -s
   ```

5. xformersのインストールをスキップ:
   ```bash
   ./venv_setup.sh -x
   ```

### 仮想環境の使用

スクリプト実行後、以下のコマンドで仮想環境をアクティベートできます：

```bash
source <work_directory>/venv/bin/activate
```

仮想環境を終了するには：

```bash
deactivate
```

## PyTorchバージョンの選択

スクリプトは自動的にシステムのCUDAバージョンを検出し、適切なPyTorchバージョンを推奨します。ユーザーは推奨バージョンを使用するか、別のバージョンを選択することができます。

- CUDA 12.1以上: PyTorch (CUDA 12.1)
- CUDA 11.8以上12.0未満: PyTorch (CUDA 11.8)
- CUDA未検出またはその他: CPU版PyTorch

## 注意事項

- このスクリプトを実行するには、Python 3とpipがシステムにインストールされている必要があります。
- CUDAバージョンの検出にはnvidia-smiコマンドを使用します。
- スクリプトはBashシェル用に書かれています。他のシェルでの動作は保証されません。
- 仮想環境は指定された作業ディレクトリ内の`venv`サブディレクトリに作成されます。

## トラブルシューティング

- スクリプトが実行できない場合は、実行権限があることを確認してください：
  ```bash
  chmod +x venv_setup.sh
  ```
- 仮想環境の作成に失敗する場合は、Python 3が正しくインストールされていることを確認してください。
- PyTorchのインストールに問題がある場合は、インターネット接続を確認し、必要に応じてプロキシ設定を行ってください。
- CUDAバージョンが正しく検出されない場合は、NVIDIAドライバーが正しくインストールされていることを確認してください。
